<html>
<head>
  <title>动态按钮选择事件</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601302 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4478"/>
<h1>动态按钮选择事件</h1>

<div>
<span><div>//脚本循环生产线按钮事件</div><div>for(i=8;i&lt;=45;i++){</div><div>    //轮询获取每个按钮的TEXT值</div><div>    scriptInit= &quot;btnText = button&quot;+i+&quot;.getText();&quot;</div><div>    scriptInit= scriptInit+&quot;button&quot;+i+&quot;.setForeColor(class java.awt.Color(255,255,255));&quot;</div><div>    scriptInit= scriptInit+&quot;if(btnText.toString().startsWith(\&quot;OP\&quot;)){\n&quot;</div><div>    scriptInit= scriptInit+&quot;if(btnText.length() == 5){\n&quot;</div><div>    scriptInit= scriptInit+&quot;stationName = btnText.toString().substring(0,5);\n&quot;</div><div>    scriptInit= scriptInit+&quot;setProperty(\&quot;station\&quot;,stationName);\n&quot;</div><div>    scriptInit= scriptInit+&quot;setProperty(\&quot;line\&quot;,\&quot;assy\&quot;);\n&quot;</div><div>    scriptInit= scriptInit+&quot;}\n&quot;</div><div>    scriptInit= scriptInit+&quot;else if(btnText.length() == 8){\n&quot;</div><div>    scriptInit= scriptInit+&quot;stationName = btnText.toString().substring(0,5);\n&quot;</div><div>    scriptInit= scriptInit+&quot;if(long(stationName.substring(2,5)) &lt;= 380 ){\n&quot;</div><div>    scriptInit= scriptInit+&quot;setProperty(\&quot;line\&quot;,\&quot;assy\&quot;);\n&quot;</div><div>    scriptInit= scriptInit+&quot;}\n&quot;</div><div>    scriptInit= scriptInit+&quot;setProperty(\&quot;station\&quot;,stationName);\n&quot;</div><div>    scriptInit= scriptInit+&quot;}\n&quot;</div><div>    scriptInit= scriptInit+&quot;else if(btnText.length() &gt;= 10){\n&quot;</div><div>    scriptInit= scriptInit+&quot;stationName = btnText.toString().substring(0,7);\n&quot;</div><div>    scriptInit= scriptInit+&quot;if(long(stationName.substring(2,5)) &lt;= 380 ){\n&quot;</div><div>    scriptInit= scriptInit+&quot;setProperty(\&quot;line\&quot;,\&quot;assy\&quot;);\n&quot;</div><div>    scriptInit= scriptInit+&quot;}\n&quot;</div><div>    scriptInit= scriptInit+&quot;setProperty(\&quot;station\&quot;,stationName);\n&quot;</div><div>    scriptInit= scriptInit+&quot;}\n&quot;</div><div>    scriptInit= scriptInit+&quot;}\n&quot;</div><div>    eval(scriptInit)</div><div>    </div><div>    //获取工位对应的机型号</div><div>//     sqlQueue = &quot;select a.station,b.engine_model_s from PP_STATION_ENGINE a,uda_order b</div><div>//     where a.station='&quot;+stationName+&quot;' and a.order_id=b.order_id_s and a.row_num=b.row_num_i&quot;</div><div>    sqlQueue = &quot;SELECT TOP 1 [CODE_VALUE],[MODEL] FROM [dbo].[EM_TEMP_WIP]</div><div>    WHERE [CODE_VALUE] = '&quot;+stationName+&quot;' ORDER BY PASS_TIME ASC &quot;</div><div>    println(sqlQueue)</div><div>    vectorQueue = getArrayDataFromActive(sqlQueue)</div><div>    for(j=0;j&lt;vectorQueue.size();j++){</div><div>        row = vectorQueue.elementAt(j)</div><div>        station=row[0].toString()</div><div>        engineModel=row[1].toString()</div><div>        if(station != &quot;&quot; &amp;&amp; engineModel != &quot;&quot;){</div><div>            strModel = &quot;&quot;</div><div>            PRE_SQL = &quot;select Sequence_S from AT_EM_INFO_MODEL where Model_Code_S = '&quot;+engineModel+&quot;' &quot;  </div><div>            vectorPcp = querySql(PRE_SQL)</div><div>            if(vectorPcp.size() &gt;0){</div><div>                for(t=0;t&lt;vectorPcp.size();t++){</div><div>                    strModel = vectorPcp.elementAt(t)[0]</div><div>                    scriptSetText=&quot;button&quot;+i+&quot;.setText(\&quot;&quot;+station+&quot;[&quot;+strModel+&quot;]\&quot;);&quot;</div><div>                    eval(scriptSetText)</div><div>                }</div><div>            }</div><div>        }</div><div>        </div><div>    }   </div><div>    </div><div>    // //按钮单击事件</div><div>    script= &quot;buttonText = button&quot;+i+&quot;.getText();&quot;</div><div>    script= script+&quot;if(buttonText.toString().startsWith(\&quot;OP\&quot;)){\n&quot;</div><div>    script= script+&quot;if(buttonText.length() == 5){\n&quot;</div><div>    script= script+&quot;strSeq = buttonText.toString().substring(0,5);\n&quot;</div><div>    script= script+&quot;setProperty(\&quot;btnName\&quot;,strSeq);\n&quot;</div><div>    script= script+&quot;setProperty(\&quot;prodLine\&quot;,\&quot;assy\&quot;);\n&quot;</div><div>    script= script+&quot;showAsDialog(\&quot;XDEC_EM_INFO_DETAIL\&quot;);\n&quot;</div><div>    script= script+&quot;}\n&quot;</div><div>    script= script+&quot;else if(buttonText.length() == 8){\n&quot;</div><div>    script= script+&quot;strSeq = buttonText.toString().substring(0,5);\n&quot;</div><div>    script= script+&quot;setProperty(\&quot;btnName\&quot;,strSeq);\n&quot;</div><div>    script= script+&quot;if(long(strSeq.substring(2,5)) &lt;= 380 ){\n&quot;</div><div>    script= script+&quot;setProperty(\&quot;prodLine\&quot;,\&quot;assy\&quot;);\n&quot;</div><div>    script= script+&quot;}\n&quot;</div><div>    scriptInit= scriptInit+&quot;setProperty(\&quot;station\&quot;,stationName);\n&quot;</div><div>    script= script+&quot;showAsDialog(\&quot;XDEC_EM_INFO_DETAIL\&quot;);\n&quot;</div><div>    script= script+&quot;}\n&quot;</div><div>    script= script+&quot;else if(buttonText.length() &gt; 8){\n&quot;</div><div>    script= script+&quot;strSeq = buttonText.toString().substring(0,7);\n&quot;</div><div>    script= script+&quot;setProperty(\&quot;btnName\&quot;,strSeq);\n&quot;</div><div>    script= script+&quot;if(long(strSeq.substring(2,5)) &lt;= 380){\n&quot;</div><div>    script= script+&quot;setProperty(\&quot;prodLine\&quot;,\&quot;assy\&quot;);\n&quot;</div><div>    script= script+&quot;}\n&quot;</div><div>    scriptInit= scriptInit+&quot;setProperty(\&quot;station\&quot;,stationName);\n&quot;</div><div>    script= script+&quot;showAsDialog(\&quot;XDEC_EM_INFO_DETAIL\&quot;);\n&quot;</div><div>    script= script+&quot;}\n&quot;</div><div>    script= script+&quot;}\n&quot;</div><div>    println(script)</div><div>    evalStr=&quot;button&quot;+i+&quot;.setClickScript(script)&quot;</div><div>    eval(evalStr)</div><div>    </div><div>    //轮循设备状态</div><div>    stationName = getProperty(&quot;station&quot;)</div><div>    prodLine = getProperty(&quot;line&quot;)</div><div>    sqlQuery = &quot;&quot;</div><div>    if(stationName != null){</div><div>        if(prodLine == &quot;assy&quot;){</div><div>            sqlQuery = &quot;SELECT T1.[DeviceID],T1.[DeviceName],T1.[CommErr],T1.[AutoRunning],T1.[AutoStartEnabled],T1.[Manual]</div><div>                ,T1.[Alarm],T1.[AlarmCode1],T1.[AlarmCode2],T1.[AlarmCode3],T1.[AlarmCode4],T1.[AlarmCode5],T1.[Warning]</div><div>                ,T1.[WarningCode1],T1.[WarningCode2],T1.[WarningCode3],T1.[WarningCode4],T1.[WarningCode5]</div><div>                FROM [dbo].[EM_ASSY_DEVICE_STATUS] T1,AT_EM_EQUIPMENT_LIST_CONF T2</div><div>                WHERE T1.[DeviceID] = T2.EQUIPMENT_CODE_S and t2.[STATION_S] ='&quot;+stationName+&quot;' and T1.[FromPLC] = 0&quot;</div><div>        }</div><div>        list = querySql(sqlQuery)</div><div>        if(list.size()&gt;0){</div><div>            for(j=0;j&lt;list.size();j++){</div><div>                strDeviceID = list.elementAt(j)[0]</div><div>                strDeviceName = list.elementAt(j)[1]</div><div>                iCommErr = list.elementAt(j)[2]</div><div>                iAutoRunning = list.elementAt(j)[3]</div><div>                iAutoStartEnabled = list.elementAt(j)[4]</div><div>                iManual = list.elementAt(j)[5]</div><div>                iAlarm = list.elementAt(j)[6]</div><div>                iWarning = list.elementAt(j)[12]  </div><div>                </div><div>                //设备自动运行中 1为此状态，0反之</div><div>                if(iAutoRunning == &quot;1&quot;){</div><div>                    scriptC=&quot;button&quot;+i+&quot;.setBackColor(class java.awt.Color(0,255,0));&quot;</div><div>                    eval(scriptC)</div><div>                }</div><div>                //设备自动启动使能状态（准备好） 1为此状态，0反之</div><div>                if(iAutoStartEnabled == &quot;1&quot;){</div><div>                    scriptC=&quot;button&quot;+i+&quot;.setBackColor(class java.awt.Color(0,153,153));&quot;</div><div>                    eval(scriptC)</div><div>                }</div><div>                //设备手动状态 1为此状态，0反之</div><div>                if(iManual ==&quot;1&quot;){</div><div>                    scriptC=&quot;button&quot;+i+&quot;.setBackColor(class java.awt.Color(153,153,255));&quot;</div><div>                    eval(scriptC)</div><div>                }</div><div>                </div><div>                //设备警告 1为警告，0为正常</div><div>                if(iWarning == &quot;1&quot;){</div><div>                    scriptC=&quot;button&quot;+i+&quot;.setBackColor(class java.awt.Color(255,255,0));&quot;</div><div>                    eval(scriptC)</div><div>                }</div><div>                </div><div>                //设备报警 1为报警，0为正常</div><div>                if(iAlarm == &quot;1&quot;){</div><div>                    scriptC=&quot;button&quot;+i+&quot;.setBackColor(class java.awt.Color(255,0,0));&quot;</div><div>                    eval(scriptC)</div><div>                }</div><div>                //设备通讯故障 1为故障，0为正常   </div><div>                if(iCommErr == &quot;1&quot;){</div><div>                    scriptC=&quot;button&quot;+i+&quot;.setBackColor(class java.awt.Color(0,0,0));&quot;</div><div>                    eval(scriptC)</div><div>                }  </div><div>            }</div><div>        }</div><div>        //显示LOG信息  </div><div>        sql = &quot;SELECT '',[DEVICE_ID],[DEVICE_NAME],CONVERT(VARCHAR(100),[RECODE_TIME], 20) [RECODE_TIME],</div><div>        CONVERT(VARCHAR(100),[RECODE_END_TIME], 20) [RECODE_END_TIME],[ERR_MSG] FROM [dbo].[EM_STATUS_LOG]</div><div>        WHERE LEFT(CONVERT(VARCHAR,[RECODE_TIME],120),10) = LEFT(CONVERT(VARCHAR,getdate(),120),10)&quot;</div><div>        vectorPart = querySql(sql,&quot;order by RECODE_TIME DESC&quot;)</div><div>        gridList.clearGrid()</div><div>        gridList.setNumberOfRows(0)</div><div>        addVectorToGrid(vectorPart, gridList)</div><div>        setGridSeq(gridList)</div><div>    }</div><div>}·</div></span>
</div></body></html> 