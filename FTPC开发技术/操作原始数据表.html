<html>
<head>
  <title>操作原始数据表</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601302 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4244"/>
<h1>操作原始数据表</h1>

<div>
<span><div>第一步：创建原始表：用create语句</div><div>create  table IM_ImportPlan</div><div>(</div><div>    plan_key   int IDENTITY (1,1) PRIMARY KEY</div><div>    plan_number  varchar(80) not null,</div><div>     part_number  varchar(80) not null,</div><div>    plan_qty   Float  not null,</div><div>    work_shop  varchar(80),</div><div>    plan_type  int not null,</div><div>    plan_starttime  datetime ,</div><div>    plan_finishtime  datetime,</div><div>    status  int ,</div><div>    route_name  varchar(80),</div><div>    plan_desc varchar(80),</div><div>    remarks  varchar(80)</div><div>    create_time datetime,</div><div>    modification_time datetime,</div><div>    modified_by varchar(80)</div><div>)</div><div><br/></div><div>第二部： 创建At表</div><div><img src="操作原始数据表_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>第三部：</div><div>编写list  修改数据库连接地址与账户名密码<img src="操作原始数据表_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>&lt;bean id=&quot;IMPLAN&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;</div><div>        &lt;!-- 基本属性 url、user、password --&gt;</div><div>        &lt;property name=&quot;url&quot; value=&quot;jdbc:<a href="sqlserver://47.98.107.150:1433;DatabaseName=MESPDB/">sqlserver://47.98.107.150:1433;DatabaseName=MESPDB</a>&quot; /&gt;</div><div>        &lt;property name=&quot;username&quot; value=&quot;MESPDB&quot; /&gt;</div><div>        &lt;property name=&quot;password&quot; value=&quot;Seedoo123&quot; /&gt;</div><div>        &lt;!-- 配置初始化大小、最小、最大 --&gt;</div><div>        &lt;property name=&quot;initialSize&quot; value=&quot;5&quot; /&gt;</div><div>        &lt;property name=&quot;minIdle&quot; value=&quot;5&quot; /&gt;</div><div>        &lt;property name=&quot;maxActive&quot; value=&quot;10&quot; /&gt;</div><div>        &lt;!-- 配置从连接池获取连接等待超时的时间 --&gt;</div><div>        &lt;property name=&quot;maxWait&quot; value=&quot;10000&quot; /&gt;</div><div>        &lt;!-- 配置间隔多久启动一次DestroyThread，对连接池内的连接才进行一次检测，单位是毫秒。</div><div>        检测时:1.如果连接空闲并且超过minIdle以外的连接，如果空闲时间超过minEvictableIdleTimeMillis设置的值则直接物理关闭。2.在minIdle以内的不处理。</div><div>        --&gt;</div><div>        &lt;property name=&quot;timeBetweenEvictionRunsMillis&quot; value=&quot;600000&quot; /&gt;</div><div>        &lt;!-- 配置一个连接在池中最大空闲时间，单位是毫秒 --&gt;</div><div>        &lt;property name=&quot;minEvictableIdleTimeMillis&quot; value=&quot;300000&quot; /&gt;</div><div>        &lt;!-- 设置从连接池获取连接时是否检查连接有效性，true时，每次都检查;false时，不检查 --&gt;</div><div>        &lt;property name=&quot;testOnBorrow&quot; value=&quot;false&quot; /&gt;</div><div>        &lt;!-- 设置往连接池归还连接时是否检查连接有效性，true时，每次都检查;false时，不检查 --&gt;</div><div>        &lt;property name=&quot;testOnReturn&quot; value=&quot;false&quot; /&gt;</div><div>        &lt;!-- 设置从连接池获取连接时是否检查连接有效性，true时，如果连接空闲时间超过minEvictableIdleTimeMillis进行检查，否则不检查;false时，不检查 --&gt;</div><div>        &lt;property name=&quot;testWhileIdle&quot; value=&quot;true&quot; /&gt;</div><div>        &lt;!-- 检验连接是否有效的查询语句。如果数据库Driver支持ping()方法，则优先使用ping()方法进行检查，否则使用validationQuery查询进行检查。(Oracle jdbc Driver目前不支持ping方法) --&gt;</div><div>        &lt;property name=&quot;validationQuery&quot; value=&quot;select getdate()&quot; /&gt;</div><div>        &lt;!-- 单位：秒，检测连接是否有效的超时时间。底层调用jdbc Statement对象的void setQueryTimeout(int seconds)方法 --&gt;</div><div>        &lt;!-- &lt;property name=&quot;validationQueryTimeout&quot; value=&quot;1&quot; /&gt;  --&gt;</div><div>        &lt;!-- 打开后，增强timeBetweenEvictionRunsMillis的周期性连接检查，minIdle内的空闲连接，每次检查强制验证连接有效性. 参考：<a href="https://github.com/alibaba/druid/wiki/KeepAlive_cn">https://github.com/alibaba/druid/wiki/KeepAlive_cn</a> --&gt;</div><div>        &lt;property name=&quot;keepAlive&quot; value=&quot;true&quot; /&gt;</div><div>        &lt;!-- 连接泄露检查，打开removeAbandoned功能 , 连接从连接池借出后，长时间不归还，将触发强制回连接。回收周期随timeBetweenEvictionRunsMillis进行，如果连接为从连接池借出状态，并且未执行任何sql，并且从借出时间起已超过removeAbandonedTimeout时间，则强制归还连接到连接池中。 --&gt;</div><div>        &lt;property name=&quot;removeAbandoned&quot; value=&quot;true&quot; /&gt;</div><div>        &lt;!-- 超时时间，秒 --&gt;</div><div>        &lt;property name=&quot;removeAbandonedTimeout&quot; value=&quot;80&quot;/&gt;</div><div>        &lt;!-- 关闭abanded连接时输出错误日志，这样出现连接泄露时可以通过错误日志定位忘记关闭连接的位置 --&gt;</div><div>        &lt;property name=&quot;logAbandoned&quot; value=&quot;true&quot; /&gt;</div><div>        &lt;!-- 根据自身业务及事务大小来设置 --&gt;</div><div>        &lt;property name=&quot;connectionProperties&quot; value=&quot;<a href="http://oracle.net.connect_timeout=2000;oracle.jdbc.readtimeout=10000/">oracle.net.CONNECT_TIMEOUT=2000;oracle.jdbc.ReadTimeout=10000</a>&quot;&gt;&lt;/property&gt;</div><div>        &lt;!-- 打开PSCache，并且指定每个连接上PSCache的大小，Oracle等支持游标的数据库，打开此开关，会以数量级提升性能，具体查阅PSCache相关资料 --&gt;</div><div>        &lt;property name=&quot;poolPreparedStatements&quot; value=&quot;true&quot; /&gt;</div><div>        &lt;property name=&quot;maxPoolPreparedStatementPerConnectionSize&quot; value=&quot;20&quot; /&gt;   </div><div>        &lt;!-- 配置监控统计拦截的filters --&gt;</div><div>        &lt;!-- &lt;property name=&quot;filters&quot; value=&quot;stat,slf4j&quot; /&gt; --&gt;</div><div>        &lt;!-- &lt;property name=&quot;proxyFilters&quot;&gt;</div><div>            &lt;list&gt;</div><div>                &lt;ref bean=&quot;log-filter&quot; /&gt;</div><div>                &lt;ref bean=&quot;stat-filter&quot; /&gt;</div><div>            &lt;/list&gt;</div><div>        &lt;/property&gt; --&gt;</div><div>        &lt;!-- 配置监控统计日志的输出间隔，单位毫秒，每次输出所有统计数据会重置，酌情开启 --&gt;</div><div>        &lt;property name=&quot;timeBetweenLogStatsMillis&quot; value=&quot;120000&quot; /&gt;</div><div>    &lt;/bean&gt;</div><div>&lt;/beans&gt;</div><div><br/></div><div><br/></div><div><br/></div><div>第四部：</div><div><br/></div><div>编写subroutines</div><div>importSubroutine(&quot;MES_Common_Time&quot;)</div><div>importSubroutine(&quot;MES_PP_Common&quot;)</div><div><br/></div><div>function selectATWData(ds){</div><div><br/></div><div>                 dsItem = class <a href="http://com.ftpc.common.utilities.datasourceutility::getInstance().getDataSource(/">com.ftpc.common.utilities.DataSourceUtility::getInstance().getDataSource(&quot;IMPLAN</a>&quot;)</div><div>//              dsItem = class <a href="http://com.ftpc.common.utilities.datasourceutility::getInstance().getDataSource(/">com.ftpc.common.utilities.DataSourceUtility::getInstance().getDataSource(&quot;Im_plan</a>&quot;)</div><div>             sql = &quot;select  '',plan_key,plan_number,part_number,plan_qty,work_shop,plan_type,plan_starttime,plan_finishtime,</div><div>                    status,route_name,plan_desc,remarks,create_time,modification_time,modified_by</div><div>                    from  IM_ImportPlan&quot;   </div><div>              </div><div>              vectorResult = class <a href="http://com.ftpc.common.utilities.jdbcutility::executeQuery(dsItem/">com.ftpc.common.utilities.JdbcUtility::executeQuery(dsItem</a>, sql)</div><div>              </div><div>              if(vectorResult.size() == 0){</div><div>                </div><div>                   return</div><div>                }</div><div>                for(i = 0; i &lt; vectorResult.size(); i++)</div><div>                {</div><div>                        atrow = createATHandler(&quot;IM_ImportPlan&quot;).createATRow()</div><div>                        sprtResult = vectorResult.get(i)</div><div>                        atrow.setValue(&quot;plan_number&quot;,sprtResult[2])</div><div>                        atrow.setValue(&quot;part_number&quot;,sprtResult[3])</div><div>                        atrow.setValue(&quot;plan_qty&quot;,sprtResult[4])</div><div>                        atrow.setValue(&quot;work_shop&quot;,sprtResult[5])</div><div>                        atrow.setValue(&quot;plan_type&quot;,sprtResult[6])</div><div>//                         atrow.setValue(&quot;plan_starttime&quot;,sprtResult[7])</div><div>//                         atrow.setValue(&quot;plan_finishtime&quot;,sprtResult[8])</div><div>                        atrow.setValue(&quot;status&quot;,sprtResult[9])</div><div>                        atrow.setValue(&quot;route_name&quot;,sprtResult[10])</div><div>                        atrow.setValue(&quot;plan_desc&quot;,sprtResult[11])</div><div>                        atrow.setValue(&quot;remarks&quot;,sprtResult[12])</div><div>//                         atrow.setValue(&quot;create_time&quot;,sprtResult[13])</div><div>//                         atrow.setValue(&quot;modification_time&quot;,sprtResult[14])</div><div>                        atrow.setValue(&quot;modified_by&quot;,sprtResult[15])</div><div>                        response = atrow.save(null,null,null)</div><div>                        responset =  class <a href="http://com.ftpc.common.utilities.jdbcutility::executeUpdatePnuts(dsItem/">com.ftpc.common.utilities.JdbcUtility::executeUpdatePnuts(dsItem</a>, &quot;update IM_ImportPlan set status = 3 where status = &quot;+sprtResult[9])</div><div>                 }       </div><div>             }</div><div><br/></div><div><br/></div><div>第五部：</div><div><br/></div><div><img src="操作原始数据表_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><br/></div><div>importSubroutine(&quot;MES_Common_UI&quot;)</div><div>importSubroutine(&quot;MES_Common_Time&quot;)</div><div>importSubroutine(&quot;MES_PR_Common&quot;)</div><div>importSubroutine(&quot;MES_IM_Plan&quot;)</div><div><br/></div><div>function deletesODS(){</div><div><br/></div><div>   ds =  class <a href="http://com.ftpc.common.utilities.datasourceutility::getInstance().getDataSource(/">com.ftpc.common.utilities.DataSourceUtility::getInstance().getDataSource(&quot;IMPLAN</a>&quot;)</div><div>   dsa =  selectATWData(ds)</div><div>//   </div><div>   println(dsa)</div><div>//    println(pse)</div><div><br/></div><div>}</div><div><br/></div><div><br/></div><div><br/></div><div>调用方法 ：执行查询语句bing修改 计划状态</div><div><br/></div></span>
</div></body></html> 