<html>
<head>
  <title>接口服务</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601302 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4462"/>
<h1>接口服务</h1>

<div>
<span><div>importSubroutine(&quot;MES_Common_UI&quot;)</div><div>importSubroutine(&quot;MES_Common_Time&quot;)</div><div>importSubroutine(&quot;MES_Common_Combobox&quot;)</div><div>importSubroutine(&quot;MES_PP_Common&quot;)</div><div>importSubroutine (&quot;ra_errorHandling&quot;)</div><div>importSubroutine (&quot;MES_Common_Base&quot;)</div><div>importSubroutine (&quot;MES_Common_Log&quot;)</div><div>importSubroutine(&quot;MES_PP_Common&quot;)</div><div>importSubroutine(&quot;MES_Common_DataDict&quot;)</div><div>importSubroutine(&quot;MES_OM_Common&quot;)</div><div>import(&quot;com.rockwell.discrete.mes.system.model.um.employee.MESUMEmployee&quot;)</div><div>import(&quot;com.rockwell.discrete.mes.system.model.um.employee.MESUMEmployeeFilter&quot;)</div><div>DSS_NAME = &quot;PDS&quot;</div><div>/**</div><div>* 描述: 获取IMS中间表的花名册信息：新增，更新</div><div>*</div><div>* @author: QF 08/25/2020</div><div>* @revision: 1.0  </div><div>**/</div><div>function getUserInfoByIMS(listboxMessage)</div><div>{</div><div>    sql = &quot;    select</div><div>              plan_key,</div><div>              plan_number,</div><div>              part_number,</div><div>              plan_qty,</div><div>              work_shop,</div><div>              plan_type,</div><div>              plan_starttime,</div><div>              plan_finishtime,</div><div>              status,</div><div>              route_name,</div><div>              plan_desc,</div><div>              remarks,</div><div>              create_time,</div><div>              modification_time,</div><div>              modified_by,</div><div>              import_status</div><div>              from</div><div>              IM_ImportPlan  where 1=1 &quot;</div><div>    vectorData = getArrayDataFromActive(sql)</div><div>    vectorPlannumber = vector()</div><div>    vectorFlag = vector()</div><div>    user = getCurrentUser()</div><div>    if(!vectorData.isEmpty())</div><div>    {</div><div>        listboxMessage.setText(&quot;开始执行---》&quot;)</div><div>        for(i=0;i&lt;vectorData.size();i++)</div><div>        {</div><div>            data = vectorData.get(i)</div><div>            plan_number = data[1]</div><div>            if(plan_number != null)</div><div>            {</div><div>                //判断当前用户在花名册表已存在</div><div>                filterObj = createATRowFilter(&quot;IM_ImportPlan&quot;)</div><div>                filterObj.forColumnNameEqualTo(&quot;plan_number&quot;,plan_number)</div><div>                planobject = createATHandler(&quot;IM_ImportPlan&quot;).getATRowsByFilter(filterObj,true)  </div><div>                vectorExec = planobject</div><div>                if(!vectorExec.isEmpty())</div><div>                {</div><div>                    plannumber = vectorExec.get(0)</div><div>                    //listboxMessage.setText(&quot;工号:&quot;+mesUmEmployee.getUsername()+&quot;姓名:&quot;+mesUmEmployee.getDescription()+&quot;已存在，开始更新&quot;)</div><div>                    //listboxMessage.addItem(&quot;工号:&quot;+mesUmEmployee.getUsername()+&quot;姓名:&quot;+mesUmEmployee.getDescription()+&quot;已存在，开始更新&quot;)</div><div>                    addLastInfoToListBox(listboxMessage,&quot;计划编号:&quot;+data[1]+&quot;型号:&quot;+data[2]+&quot;已存在&quot;)</div><div>                    flag =true</div><div>                }</div><div>                else</div><div>                {</div><div>                    plannumber =data[0]</div><div>                    //listboxMessage.setText(&quot;工号:&quot;+mesUmEmployee.getUsername()+&quot;姓名:&quot;+mesUmEmployee.getDescription()+&quot;已存在，开始更新&quot;)</div><div>                    //listboxMessage.addItem(&quot;工号:&quot;+mesUmEmployee.getUsername()+&quot;姓名:&quot;+mesUmEmployee.getDescription()+&quot;已存在，开始更新&quot;)</div><div>                    addLastInfoToListBox(listboxMessage,&quot;计划编号:&quot;+data[1]+&quot;型号:&quot;+data[2]+&quot;开始新增&quot;)</div><div>                    flag = saveToDB(plannumber,data,listboxMessage)</div><div>                }</div><div>                vectorPlannumber.add(plannumber)</div><div>                //获取保存成功的条数</div><div>                </div><div>                if(flag == true)</div><div>                {</div><div>                    vectorFlag.add(flag)</div><div>                }</div><div>            }</div><div>        }</div><div>    }</div><div>    if(vectorFlag.size() == vectorPlannumber.size())</div><div>    {</div><div>        handleInfoMsg(&quot;MES_MAINFROM_MSG_TRX&quot;, &quot;SAVE_SUCCESSFULLY&quot;, null, null, HANDLER_OPTION_DEFAULT, null)</div><div>        logInfo(FORM_MODULE,&quot; save succefully&quot;, getDBTime(), &quot;subroutine:MES_OM_Interface_GetUserInfoByIMS&quot;  , &quot;Function:getUserInfoByIMS()&quot;)</div><div>        //listboxMessage.addItem(&quot;《--执行完毕&quot;)</div><div>        addLastInfoToListBox(listboxMessage,&quot;《--执行完毕&quot;)</div><div>    }</div><div>}</div><div>//保存到PART表</div><div>function saveToDB(plannumber,data,listboxMessage)</div><div>{</div><div>        obj  = data</div><div>        handler = createATHandler(&quot;IM_ImportPlan&quot;)</div><div>           </div><div>        atrowPlan = handler.createATRow()</div><div>        //产品型号</div><div>         atrowPlan.setValue(&quot;import_key&quot;,Long(obj[0]))</div><div>        atrowPlan.setValue(&quot;plan_number&quot;,obj[1])</div><div>        //计划编号</div><div>        atrowPlan.setValue(&quot;part_number&quot;,obj[2])</div><div>        //计划数量</div><div>        atrowPlan.setValue(&quot;plan_qty&quot;,obj[3])</div><div>        //计划发起时间</div><div>        atrowPlan.setValue(&quot;work_shop&quot;,obj[4])</div><div>        //计划完成时间</div><div>        atrowPlan.setValue(&quot;plan_type&quot;,Long(obj[5]))</div><div>        atrowPlan.setValue(&quot;plan_starttime&quot;,obj[6])</div><div>        atrowPlan.setValue(&quot;plan_finishtime&quot;,obj[7])</div><div>        atrowPlan.setValue(&quot;status&quot;,1)</div><div>        atrowPlan.setValue(&quot;route_name&quot;,obj[9])</div><div>        atrowPlan.setValue(&quot;plan_desc&quot;,obj[10])</div><div>        atrowPlan.setValue(&quot;remarks&quot;,obj[11])</div><div>        atrowPlan.setValue(&quot;create_time&quot;,obj[12])</div><div>        atrowPlan.setValue(&quot;modification_time&quot;,obj[13])</div><div>        </div><div>        response = atrowPlan.save(null,null,null)</div><div>       </div><div>        checkAndDisplayResponse(response)</div><div>        if(response.isOk())</div><div>        {</div><div>        println(&quot;计划导入成功&quot;)</div><div>        flag = true</div><div>        return flag</div><div>        </div><div>        }</div><div>}</div><div><br/></div><div><br/></div><div><br/></div><div>前台调用界面 </div><div><img src="接口服务_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>调用方法：</div><div>importSubroutine(&quot;MES_Import_Ims&quot;)</div><div>//runFunctionThread(getPartInfoByIMS,listboxMessage)</div><div><br/></div><div>runFunctionThread(getUserInfoByIMS,[listboxMessage])</div><div><br/></div></span>
</div></body></html> 