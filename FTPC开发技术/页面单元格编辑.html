<html>
<head>
  <title>页面单元格编辑</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601302 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4239"/>
<h1>页面单元格编辑</h1>

<div>
<span><div><br/></div><div><br/></div><div>importSubroutine(&quot;MES_Common_UI&quot;)</div><div>importSubroutine (&quot;MES_Common_Base&quot;)</div><div>importSubroutine (&quot;MES_Common_Time&quot;)</div><div>importSubroutine(&quot;MES_Common_Configuration&quot;)</div><div>importSubroutine (&quot;MES_Common_Grid-2.0&quot;)</div><div>importSubroutine(&quot;MES_Common_Grid&quot;)</div><div>importSubroutine (&quot;MES_WM_Common&quot;)</div><div>importSubroutine (&quot;ra_errorHandling&quot;)</div><div>importSubroutine (&quot;MES_Common_Log&quot;)</div><div>importSubroutine (&quot;MES_Common_Constant&quot;)</div><div>importSubroutine(&quot;MES_Common_Privilege&quot;)</div><div>importSubroutine(&quot;MES_Common_ChoiceList&quot;)</div><div>import(&quot;<a href="http://com.rockwell.autosuite.mes.utilities.common.timehelper/">com.rockwell.autosuite.mes.utilities.common.TimeHelper</a>&quot;)</div><div>GRIDHEADERLABELTEXTTYPE = 1</div><div>FORM_MODULE = MODULE_OM</div><div><br/></div><div>SQL_FIXED =  &quot;select '',</div><div>          </div><div>              Plan_Number_S,Material_Code_S,Product_Number_S,Plan_Quantity_I,WorkShop_Form_S,</div><div>WorkShop_To_S,Plan_Type_I,(SUBSTRING(CONVERT(nvarchar, Plan_StartTime_T, 120), 1, 10))Plan_StartTime_T,(SUBSTRING(CONVERT(nvarchar, Plan_FinishTime_T, 120), 1, 10))Plan_FinishTime_T,Station_S,</div><div>State_I,Work_Center_S,Remarks_S,Plan_Import_N_S,(SUBSTRING(CONVERT(nvarchar, Plan_Import_T_T, 120), 1, 10))Plan_Import_T_T,Plan_Audit_N_S,Plan_Audit_R_S,(SUBSTRING(CONVERT(nvarchar, Plan_Audit_T_T, 120), 1, 10))Plan_Audit_T_T,</div><div>Plan_Version_I,atr_key from  AT_OM_Plan where 1=1 &quot;</div><div>                </div><div>                </div><div>function frmInitGrid()</div><div>{</div><div>    glbInitGrid(activityGridResult)</div><div>    glbSetGridHeaderLabelText(activityGridResult, 2, labelTotalResult)  </div><div><br/></div><div>}</div><div><br/></div><div>function frmInitForm()</div><div>{</div><div>    initEnvironment()</div><div>    //=====Start Customization=======================================================================</div><div>    //=====End Customization===========================================================================</div><div>    frmReset()</div><div>    frmInitGrid()</div><div>    hideColumn(activityGridResult)</div><div>    </div><div><br/></div><div>}</div><div>function frmReset()</div><div>{</div><div>    resetAllControlValues(groupboxQueryCondition)</div><div>    //=====Start Customization=======================================================================</div><div>//     initJustStartTime(dateTimePickerInTimeForm)</div><div>//     initJustEndTime(dateTimePickerInTimeTo)</div><div>//     initDateTimePicker(dateTimePickerInTimeForm, dateTimePickerInTimeTo)</div><div>//     </div><div>//     initJustStartTime(dateTimePickerReceiveTimeFrom)</div><div>//     initJustEndTime(dateTimePickerReceiveTimeTo)</div><div>    //=====End Customization===========================================================================</div><div>}</div><div><br/></div><div>function frmQuery()</div><div>{</div><div>    //exception handle</div><div>    function handleException(exception)</div><div>    {</div><div>        //reminder message</div><div>        handleErrorMsg(&quot;MES_MAINFROM_MSG_TRX&quot;, &quot;QUERY_EXCEPTION&quot;, null, null,null, HANDLER_OPTION_DEFAULT, null)</div><div>        </div><div>        //print StackOverflowError</div><div>        logException(FORM_MODULE, exception)</div><div>        //log</div><div>        logError(FORM_MODULE, exception.getMessage(), createTime(), &quot;Form:&quot; + getActiveDsForm().getName(), &quot;Function:frmQuery()&quot;)</div><div>    }</div><div><br/></div><div>   PlanNo = editPlanNo.getText().trim()</div><div>   ProductNo = editProductNo.getText().trim()</div><div>//    PlanState =activityControlState.getChoiceValue()</div><div>   </div><div>   sql = SQL_FIXED</div><div>    if(!isEmptyStr(PlanNo))</div><div>    {</div><div>        sql += &quot; and Plan_Number_S like '%&quot;+ PlanNo +&quot;%'&quot;</div><div>    }</div><div>//     if(!isEmptyStr(PlanState))</div><div>//     {</div><div>//         sql += &quot; and Plan_Audit_R_S like '%&quot;+ PlanState +&quot;%'&quot;</div><div>//     }</div><div>    if(!isEmptyStr(ProductNo))</div><div>    {</div><div>        sql += &quot; and product_no_S like '%&quot;+ ProductNo +&quot;%'&quot;</div><div>    }</div><div>    if(dateTimePickerInTimeForm.getShowNoneIsChecked())</div><div>    {</div><div>        inTimeForm = dateTimePickerInTimeForm.getValue()</div><div>        inTimeFormStr = formatTimeByDateFormat(inTimeForm, &quot;yyyy-MM-dd HH:mm:ss&quot;)</div><div>        sql += &quot; and plan_starttime_T &gt;= ('&quot; + inTimeFormStr + &quot;') &quot;</div><div>    }</div><div>    if(dateTimePickerInTimeTo.getShowNoneIsChecked())</div><div>    {</div><div>        inTimeTo = dateTimePickerInTimeTo.getValue()</div><div>        inTimeToStr = formatTimeByDateFormat(inTimeTo, &quot;yyyy-MM-dd HH:mm:ss&quot;)</div><div>        sql += &quot; and plan_finishtime_T &lt;= ('&quot; + inTimeToStr + &quot;') &quot;</div><div>    }</div><div>    vectorData = querySql(sql+ &quot;and  Plan_Audit_R_S =N'待审批'&quot;)</div><div>    displayGridResult(vectorData,activityGridResult)</div><div>}</div><div>   function displayGridResult(vectorData,activityGridResult)</div><div>   {</div><div>    activityGridResult.clearGrid()</div><div>    activityGridResult.setNumberOfRows(0)</div><div>   </div><div>    for(i=0; i&lt;vectorData.size(); i++){</div><div>        obj = vectorData.get(i)</div><div>        </div><div>        activityGridResult.setCellText(i,0,null)</div><div>        activityGridResult.setCellText(i,1,i+1)</div><div>        activityGridResult.setCellText(i,2,obj[1])</div><div>        activityGridResult.setCellText(i,3,obj[2])</div><div>        activityGridResult.setCellText(i,4,obj[3])</div><div>        activityGridResult.setCellText(i,5,obj[4])</div><div>        activityGridResult.setCellText(i,6,obj[5])</div><div>        activityGridResult.setCellText(i,7,obj[6])</div><div>        activityGridResult.setCellText(i,8,obj[7])</div><div>        activityGridResult.setCellText(i,9,obj[8])</div><div>        activityGridResult.setCellText(i,10,obj[9])</div><div>        activityGridResult.setCellText(i,11,obj[10])</div><div>        activityGridResult.setCellText(i,12,obj[11])</div><div>        activityGridResult.setCellText(i,13,obj[12])</div><div>        activityGridResult.setCellText(i,14,obj[13])</div><div>        activityGridResult.setCellText(i,15,obj[14])</div><div>        activityGridResult.setCellText(i,16,obj[15])</div><div>        activityGridResult.setCellText(i,17,obj[16])</div><div>        activityGridResult.setCellText(i,18,obj[17])</div><div>        activityGridResult.setCellText(i,19,obj[18])</div><div>        activityGridResult.setCellText(i,20,obj[19])</div><div>        activityGridResult.setCellText(i,21,obj[20])</div><div>    }</div><div>       activityGridResult.resizeColumnsToFit()</div><div>    //生成复选框</div><div>    setGridWithCheckbox(activityGridResult)</div><div>    setMessageDescToGrid(activityGridResult,vectorData,8,&quot;Plan_Type&quot;)</div><div>//     setMessageDescToGrid(activityGridResult,vectorData,12,&quot;PLAN_STATE&quot;)</div><div>    glbSetGridHeaderLabelText(activityGridResult, GRIDHEADERLABELTEXTTYPE, labelTotalResult)</div><div>    </div><div>//     radioButtonAll.setChecked(false)</div><div>}</div><div>function frmPlanAudit()</div><div>{</div><div>    rows = activityGridResult.getNumberOfRows()   </div><div>   if(rows == 0)</div><div>   {</div><div>      dialogError(&quot;请选择一行记录！&quot;)</div><div>      return</div><div>   }</div><div>       for(i=0;i&lt;rows;i++)</div><div>       {</div><div>       checked = activityGridResult.getCellObject(i, 0)</div><div>       if(checked == false){</div><div>           continue</div><div>       }else</div><div>       {</div><div>          key = activityGridResult.getCellText(i,21)</div><div>          if(activityGridResult.getCellText(i,18)== &quot;已发布&quot;)</div><div>          {</div><div>           dialogError(&quot;计划已发布！&quot;)</div><div>            return</div><div>          }</div><div>           if(activityGridResult.getCellText(i,18)== &quot;审批失败&quot;)</div><div>          {</div><div>           dialogError(&quot;计划审批失败，请先对计划进行调整！&quot;)</div><div>            return</div><div>          }</div><div>          if(activityGridResult.getCellText(i,18)== &quot;待审批&quot;)</div><div>          {</div><div>            atrow = createATHandler(&quot;OM_Plan&quot;).getATRowByKey(Long(key),true)</div><div>//             atrow.setValue(&quot;Plan_Audit_R&quot;,&quot;已下发&quot;)</div><div>//             atrow.save(null,null,null)</div><div>             handler = createATHandler(&quot;OM_Plan&quot;)</div><div>           atrowPlan = handler.createATRow()</div><div>           </div><div>           //计划编号</div><div>            atrowPlan.setValue(&quot;Plan_Number&quot;,activityGridResult.getCellText(i,2))</div><div>            //物料编码</div><div>             atrowPlan.setValue(&quot;Material_Code&quot;,activityGridResult.getCellText(i,3))</div><div>             //产品型号</div><div>           atrowPlan.setValue(&quot;Product_Number&quot;,activityGridResult.getCellText(i,4))</div><div>            //计划数量</div><div>             atrowPlan.setValue(&quot;Plan_Quantity&quot;,Long(activityGridResult.getCellText(i,5)))</div><div>            </div><div>             // 完成车间</div><div>               atrowPlan.setValue(&quot;WorkShop_To&quot;,activityGridResult.getCellText(i,6))</div><div>                //接收车间</div><div>             atrowPlan.setValue(&quot;WorkShop_Form&quot;,activityGridResult.getCellText(i,7))</div><div>             //计划类型</div><div>             plan_type = activityGridResult.getCellText(i,8)</div><div>              if(plan_type ==&quot;标准计划&quot;)</div><div>                {</div><div>                   plan_type =1</div><div>                }</div><div>                 if(plan_type ==&quot;外协计划&quot;)</div><div>                {</div><div>                   plan_type =2</div><div>                }</div><div>                 if(plan_type ==&quot;返工计划&quot;)</div><div>                {</div><div>                   plan_type =3</div><div>                }</div><div>                atrowPlan.setValue(&quot;Plan_Type&quot;,Long(plan_type))</div><div>             //计划发起时间</div><div>              atrowPlan.setValue(&quot;Plan_StartTime&quot;,activityGridResult.getCellText(i,9))</div><div>              //计划完成时间</div><div>               atrowPlan.setValue(&quot;Plan_FinishTime&quot;,activityGridResult.getCellText(i,10))</div><div>               //机台</div><div>                atrowPlan.setValue(&quot;Station&quot;,activityGridResult.getCellText(i,11))</div><div>                //状态</div><div>                 atrowPlan.setValue(&quot;State&quot;,1)</div><div>                  //工艺流程</div><div>                   atrowPlan.setValue(&quot;Work_Center&quot;,activityGridResult.getCellText(i,13))</div><div>                   //备注</div><div>                   atrowPlan.setValue(&quot;Remarks&quot;,activityGridResult.getCellText(i,14))</div><div>                   //计划输入人员</div><div>                   atrowPlan.setValue(&quot;Plan_Import_N&quot;,activityGridResult.getCellText(i,15))</div><div>                  //计划输入时间</div><div>                   atrowPlan.setValue(&quot;Plan_Import_T&quot;,activityGridResult.getCellText(i,16))</div><div>                  //计划审批人员                </div><div>                    atrowPlan.setValue(&quot;Plan_Audit_T&quot;,createTime())</div><div>                     atrowPlan.setValue(&quot;Plan_Audit_N&quot;,getCurrentUser().getName())</div><div>                     </div><div>                  //计划版本</div><div>                  atrowPlan.setValue(&quot;Plan_Version&quot;,activityGridResult.getCellText(i,20))                  </div><div>                   response = atrowPlan.save(null,null,null)</div><div>                   checkAndDisplayResponse(response)</div><div>                   if(response.isOk())</div><div>                   {</div><div>                    println(&quot;计划创建成功&quot;)</div><div>                   }</div><div>                    atrow.setValue(&quot;Plan_Audit_R&quot;,&quot;审批成功&quot;)                    </div><div>                    atrow.save(null,null,null)</div><div>            </div><div>          }                         </div><div>       }</div><div>    }  </div><div>   frmQuery()</div><div>}</div><div><br/></div><div>//页面单元格编辑</div><div>function frmPlanSave()</div><div>{</div><div>    rows = activityGridResult.getNumberOfRows()   </div><div>   if(rows == 0)</div><div>   {</div><div>      dialogError(&quot;请选择一行记录！&quot;)</div><div>      return</div><div>   }</div><div>       for(i=0;i&lt;rows;i++)</div><div>       {</div><div>       checked = activityGridResult.getCellObject(i, 0)</div><div>       if(checked == false){</div><div>           continue</div><div>       }else</div><div>       {</div><div>          key = activityGridResult.getCellText(i,21)</div><div>          if(activityGridResult.getCellText(i,18)== &quot;已发布&quot;)</div><div>          {</div><div>           dialogError(&quot;计划已发布！&quot;)</div><div>            return</div><div>          }</div><div>           if(activityGridResult.getCellText(i,18)== &quot;审批失败&quot;)</div><div>          {</div><div>           dialogError(&quot;计划审批失败，请先对计划进行调整！&quot;)</div><div>            return</div><div>          }</div><div>          if(activityGridResult.getCellText(i,18)== &quot;待审批&quot;)</div><div>          {</div><div>            atrow = createATHandler(&quot;OM_Plan&quot;).getATRowByKey(Long(key),true)</div><div>//             atrow.setValue(&quot;Plan_Audit_R&quot;,&quot;已下发&quot;)</div><div>//             atrow.save(null,null,null)</div><div>             handler = createATHandler(&quot;OM_Plan&quot;)</div><div>           atrowPlan = handler.createATRow()</div><div>           </div><div>           //计划编号</div><div>//             atrowPlan.setValue(&quot;Plan_Number&quot;,activityGridResult.getCellText(i,2))</div><div>//             //物料编码</div><div>//              atrowPlan.setValue(&quot;Material_Code&quot;,activityGridResult.getCellText(i,3))</div><div>             //产品型号</div><div>           atrowPlan.setValue(&quot;Product_Number&quot;,activityGridResult.getCellText(i,4))</div><div>            //计划数量</div><div>             atrowPlan.setValue(&quot;Plan_Quantity&quot;,Long(activityGridResult.getCellText(i,5)))</div><div>            </div><div>             // 完成车间</div><div>               atrowPlan.setValue(&quot;WorkShop_To&quot;,activityGridResult.getCellText(i,6))</div><div>                //接收车间</div><div>             atrowPlan.setValue(&quot;WorkShop_Form&quot;,activityGridResult.getCellText(i,7))</div><div>             //计划类型</div><div>             plan_type = activityGridResult.getCellText(i,8)</div><div>              if(plan_type ==&quot;标准计划&quot;)</div><div>                {</div><div>                   plan_type =1</div><div>                }</div><div>                 if(plan_type ==&quot;外协计划&quot;)</div><div>                {</div><div>                   plan_type =2</div><div>                }</div><div>                 if(plan_type ==&quot;返工计划&quot;)</div><div>                {</div><div>                   plan_type =3</div><div>                }</div><div>                atrowPlan.setValue(&quot;Plan_Type&quot;,Long(plan_type))</div><div>             //计划发起时间</div><div>              atrowPlan.setValue(&quot;Plan_StartTime&quot;,activityGridResult.getCellText(i,9))</div><div>              //计划完成时间</div><div>               atrowPlan.setValue(&quot;Plan_FinishTime&quot;,activityGridResult.getCellText(i,10))</div><div>               //机台</div><div>                atrowPlan.setValue(&quot;Station&quot;,activityGridResult.getCellText(i,11))</div><div>                //状态</div><div>                 atrowPlan.setValue(&quot;State&quot;,1)</div><div>                  //工艺流程</div><div>                   atrowPlan.setValue(&quot;Work_Center&quot;,activityGridResult.getCellText(i,13))</div><div>                   //备注</div><div>                   atrowPlan.setValue(&quot;Remarks&quot;,activityGridResult.getCellText(i,14))</div><div>                   //计划输入人员</div><div>                   atrowPlan.setValue(&quot;Plan_Import_N&quot;,activityGridResult.getCellText(i,15))</div><div>                  //计划输入时间</div><div>                   atrowPlan.setValue(&quot;Plan_Import_T&quot;,activityGridResult.getCellText(i,16))</div><div>                  //计划审批人员                </div><div>                    atrowPlan.setValue(&quot;Plan_Audit_T&quot;,createTime())</div><div>                     atrowPlan.setValue(&quot;Plan_Audit_N&quot;,getCurrentUser().getName())</div><div>                     </div><div>                  //计划版本</div><div>                  atrowPlan.setValue(&quot;Plan_Version&quot;,activityGridResult.getCellText(i,20))                  </div><div>//                    response = atrowPlan.save(null,null,null)</div><div>//                    checkAndDisplayResponse(response)</div><div>//                    if(response.isOk())</div><div>//                    {</div><div>//                     println(&quot;计划创建成功&quot;)</div><div>//                    }</div><div>                    atrow.setValue(&quot;Plan_Number&quot;,activityGridResult.getCellText(i,2))</div><div>                    atrow.setValue(&quot;Material_Code&quot;,activityGridResult.getCellText(i,3))</div><div>                    atrow.save(null,null,null)</div><div>            </div><div>          }                         </div><div>       }</div><div>    }  </div><div>//    frmQuery()</div><div>}</div><div><br/></div><div>---------------------------------------------界面展示</div><div><img src="页面单元格编辑_files/QQ图片20200423101758.jpg" type="image/jpeg" data-filename="QQ图片20200423101758.jpg"/><img src="页面单元格编辑_files/QQ图片20200423101802.png" type="image/png" data-filename="QQ图片20200423101802.png"/></div><div><br/></div></span>
</div></body></html> 